<!--
COMPORTAMENTO ACTIVITY
Definisce l'interfaccia ed un comportamento di un activity vuota

-->

<script>

  var activityBehavior = {
    attached:function(){
      this._init();
    },

    _init:function(){
      this.activityId = this.tagName.toLowerCase();
      this.setAttribute('data-route',this.activityId);
      console.log('init: ' + this.activityId);
      document.addEventListener("sys-activity-changed",           function(e){ this._onActivityChange(e)          }.bind(this), false);
      document.addEventListener("sys-activity-params-changed",    function(e){ this._onActivityParamsChange(e)    }.bind(this), false);
      document.addEventListener("sys-application-status-changed", function(e){ this._onApplicationStatusChange(e) }.bind(this), false);
      document.addEventListener("sys-activity-refresh",           function(e){ this._onActivityRefresh(e)         }.bind(this), false);
    },

    _onApplicationStatusChange:function(e){
      var status= e.detail();
      this.appStatus = status;
      switch (status){
        case 'loading'    :{
          if(this.currentActivity === this.activityId) this.onStop();
          break;
        }
        case 'no-session' :{
          if(this.currentActivity === this.activityId) this.onStop();
          break;
        }
        case 'no-app'     :{
          if(this.currentActivity === this.activityId) this.onStop();
          this.onStop();
          break;
        }
        case 'no-network' :{
          if(this.currentActivity === this.activityId) this.onStop();
          this.onStop();
          break;
        }
        case 'allow'      :{
          if(this.currentActivity === this.activityId) this.onStart();
          break;
        }
      }
    },

    _isActivityEnabled:function(){
        return (this.appStatus==='allow' && this.currentActivity === this.activityId)
    },

    _onActivityRefresh:function(e){
      if(e.detail.activityId === this.activityId){this.onRefresh();}
    },

    _onActivityChange : function(e){
      this.currentActivity = e.detail.newActivity;
      if(this.appStatus === 'allow'){
        if(e.detail.newActivity === this.activityId){this.onStart();}
        if(e.detail.oldActivity === this.activityId){this.onStop(); }
      }
    },

    _onActivityParamsChange:function(e){
      if(e.detail.activity === this.activityId){
        this.params = e.detail.newParams;
        this.onParamsChange(e.detail.newParams, e.detail.oldParams);
      }
    },

    onStart        : function () {console.log(this.activityId+' started');},
    onStop         : function () {console.log(this.activityId+' stopped')},
    onRefresh      : function () {console.log(this.activityId+' refresh')},
    onParamsChange : function (newPars,oldPars) {console.log(this.activityId+' paramsChanged')},

    properties:{
      activityId      : String,
      currentActivity : String,
      params          : Object,
      appStatus       : String
    }
  };

</script>
