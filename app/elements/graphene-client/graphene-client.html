<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="graphene-client">
  <script src="ClientController.js"></script>
  <template></template>
  <script>
  (function() {
    'use strict';
    var ctrl = ClientController.getInstance();
    console.log("Client controller: ",ctrl);

    Polymer({
      is: 'graphene-client',
      attached:function(){
        ctrl.pushClient(this);
      },

      addProfile: function (name,serverUrl,apiKey,accessToken,otherSettings) {
        ctrl.addProfile(name,serverUrl,apiKey,accessToken,otherSettings);
      },

      selectProfile:function(profileName){
        ctrl.setCurrentProfile(profileName);
      },

      getProfiles:function(){
        return this.settings.profiles();
      },

      getProfile:function(name){
        //console.log(name);
        try{
         return this.settings.profiles[name];
        }catch(e){
          return {};
        }
      },

      gFetch:function(service,body,method,headers){
        return ctrl.gFetch(service,body,method,headers)
      },

      _onSettingChange:function(currentSettings){
        this.settings = currentSettings;
        this.fire('settings-change',this.settings);
        this._fireReady();
      },

      _onClientStatusChange:function(currentClientStatus){
        this.status = currentClientStatus;
        this.fire('status-change',this.status);
        this._fireReady();
      },

      _fireReady:function(){
        if(!!this.settings  && !!this.status && this.status.online && !this.ready){
          this.ready=true;
          this.fire('ready')
        }

      },
      properties : {
        ready           : {type:Boolean, value:false,     notify:true},
        settings        : {type:Object,  value:null,      notify:true},
        status          :Â {type:Object,  value:'loading', notify:true},
        selectedProfile : {type:Object,  computed:'getProfile(settings.selectedProfile)'}
      }

    });
  })();
  </script>
</dom-module>
